<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="document.user.mapper.UserMapper">

    <!-- 전체 사용자 목록 조회 -->
    <select id="getUserList" resultType="document.user.dto.UserDto">
        SELECT *
        FROM tb_user
        ORDER BY CRT_DT DESC
    </select>

    <!-- 사용자 ID로 조회 -->
    <select id="getUserByUserId" resultType="document.user.dto.UserDto" parameterType="String">
        SELECT *
        FROM tb_user
        WHERE USER_ID = #{userId}
    </select>

    <!-- 사용자 등록 -->
    <insert id="insertUserInfo" parameterType="document.user.dto.UserDto">
        INSERT INTO tb_user (
            USER_ID,
            USER_PASS,
            USER_NAME,
            USER_TEL,
            USER_EMAIL,
            PERMIT_ID,
            USE_FLAG,
            PWD_FCNT,
            CRT_ID,
            CRT_DT
        )
        VALUES (
                   #{userId},
                   #{userPass},
                   #{userName},
                   #{userTel},
                   #{userEmail},
                   #{permitId},
                   #{userFlag},
                   0,
                   #{userId},
                   NOW()
               )
    </insert>

    <!-- 사용자 권한 등록 -->
    <insert id="insertUserPermit" parameterType="document.user.dto.UserDto">
        INSERT INTO tb_permit (
            PERMIT_ID,
            PERMIT_NAME,
            PERMIT_DESC,
            CRT_ID,
            CRT_DT
        )
        VALUES (
                   #{permitId},
                   #{permitName},
                   #{permitDesc},
                   #{crtId},
                   #{crtDt}
               )
    </insert>

    <!-- 사용자 정보 수정 -->
    <update id="updateUserInfo" parameterType="document.user.dto.UserDto">
        UPDATE tb_user
        SET
            <if test="userName != null">
                USER_NAME = #{userName},
            </if>
            <if test="userTel != null and userTel != ''">
                USER_TEL = #{userTel},
            </if>
            <if test="userEmail != null">
                USER_EMAIL = #{userEmail},
            </if>
            <if test="permitId != null and permitId != ''">
                PERMIT_ID = #{permitId},
            </if>
            <if test="userFlag != null and userFlag != ''">
                USE_FLAG = #{userFlag},
            </if>
            UPT_ID = #{userId},
            UPT_DT = NOW()
        WHERE
        USER_ID = #{userId}
    </update>


    <!-- 비밀번호 수정 -->
    <update id="updatePassword" parameterType="document.user.dto.UserDto">
        UPDATE tb_user
        SET
            USER_PASS = #{userPass},
            UPT_ID = #{userId},
            UPT_DT = NOW()
        WHERE
            USER_ID = #{userId}
    </update>

    <!-- 비밀번호 실패 횟수 수정 -->
    <update id="updatePwdFcnt" parameterType="string">
        UPDATE tb_user
        SET
            PWD_FCNT = #{pwdFcnt}
        WHERE
            USER_ID = #{userId}
    </update>

    <!-- 권한 업데이트 -->
    <update id="updateUserPkgInfo" parameterType="document.user.dto.UserDto">
        UPDATE tb_permit
        SET
            PERMIT_ID = #{permitId}
        WHERE
            USER_ID = #{userId}
    </update>

    <!-- 사용자 삭제 -->
    <delete id="deleteUserInfo" parameterType="String">
        DELETE FROM tb_user
        WHERE USER_ID = #{userId}
    </delete>

    <!-- 로그인 -->
    <select id="login" resultType="document.user.dto.UserDto" parameterType="document.user.dto.UserDto">
        SELECT *
        FROM tb_user
        WHERE USER_ID = #{userId}
          AND USER_PASS = #{userPass}
    </select>

</mapper>
